generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                       Int            @id @default(autoincrement())
  email                    String         @unique
  username                 String?        @unique
  birthDate                DateTime?
  gender                   String?
  password                 String?
  role                     String         @default("user")
  resetToken               String?
  resetTokenExpiry         DateTime?
  emailVerificationCode    String?
  emailVerificationExpiry  DateTime?
  emailVerified            Boolean        @default(false)
  pictureUrl               String?
  posts                    Post[]
  likes                    Like[]
  createdAt                DateTime       @default(now())
  notifications            Notification[] @relation("Receiver")
  sentNotifications        Notification[] @relation("Sender")
  comments                 Comment[]
  pins                     Pin[]
  subscriptions            Subscription[] @relation("UserFollows")
  followers                Subscription[] @relation("UserFollowed")
}

model Post {
  id             Int            @id @default(autoincrement())
  imageUrl       String
  text           String
  author         User?          @relation(fields: [authorId], references: [id])
  authorId       Int
  likesCount     Int            @default(0)
  commentsCount  Int            @default(0)
  pinsCount      Int            @default(0)
  likes          Like[]
  notifications  Notification[]
  comments       Comment[]
  pins           Pin[]
  createdAt      DateTime       @default(now())
}

model Like {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  post      Post     @relation(fields: [postId], references: [id])
  postId    Int
  createdAt DateTime @default(now())
  @@unique([userId, postId])
}

model Notification {
  id          Int               @id @default(autoincrement())
  type        NotificationType
  message     String
  sender      User              @relation("Sender", fields: [senderId], references: [id])
  senderId    Int
  receiver    User              @relation("Receiver", fields: [receiverId], references: [id])
  receiverId  Int
  post        Post?             @relation(fields: [postId], references: [id])
  postId      Int
  read        Boolean           @default(false)
  createdAt   DateTime          @default(now())
}

model Comment {
  id        Int      @id @default(autoincrement())
  text      String
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int
  post      Post     @relation(fields: [postId], references: [id])
  postId    Int
  createdAt DateTime @default(now())
}

model Pin {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  post      Post     @relation(fields: [postId], references: [id])
  postId    Int
  createdAt DateTime @default(now())
  @@unique([userId, postId])
}

model Subscription {
  id          Int   @id @default(autoincrement())
  follower    User  @relation("UserFollows", fields: [followerId], references: [id])
  followerId  Int
  following   User  @relation("UserFollowed", fields: [followingId], references: [id])
  followingId Int
  createdAt   DateTime @default(now())
  @@unique([followerId, followingId])
}

enum NotificationType {
  LIKE
  COMMENT
  FOLLOW
  PIN
}